# DrawSomething ä½ ç”»AIçŒœ

ğŸ¨ åŸºäºAIçš„ä½ ç”»æˆ‘çŒœå°æ¸¸æˆ ğŸ®

## ğŸ–Œï¸ ä»€ä¹ˆæ˜¯ ä½ ç”»AIçŒœ
ä½ ç”»æˆ‘çŒœæ˜¯ä¸€æ¬¾ç»å…¸çš„ç»˜ç”»çŒœè¯æ¸¸æˆï¼Œç©å®¶é€šè¿‡ç»˜ç”»å’ŒçŒœè¯äº’åŠ¨ï¼Œäº«å—åˆ›æ„ä¸ä¹è¶£çš„ç¢°æ’ï¼

å…·ä½“æ¸¸æˆæµç¨‹å¦‚ä¸‹ï¼š
1. ç©å®¶åˆ†ä¸ºç»˜ç”»è€…å’ŒçŒœè¯è€…ã€‚
2. ç»˜ç”»è€…æ ¹æ®ç³»ç»Ÿæä¾›çš„è¯è¯­è¿›è¡Œç»˜ç”»ã€‚
3. çŒœè¯è€…æ ¹æ®ç»˜ç”»å†…å®¹è¿›è¡ŒçŒœè¯ï¼ŒçŒœä¸­å¾—åˆ†ã€‚

ä½ ç”»AIçŒœï¼Œå°†ä¼ ç»Ÿä½ ç”»æˆ‘çŒœä¸ AI æŠ€æœ¯ç›¸ç»“åˆï¼Œåœ¨åŸæœ‰çš„åŸºç¡€ä¸Šï¼ŒåŠ å…¥äº† AI çŒœè¯åŠŸèƒ½ï¼Œä¿®æ”¹åæ¸¸æˆæµç¨‹å¦‚ä¸‹ï¼š
1. ç©å®¶ä¸ºç»˜ç”»è€…ï¼Œæ ¹æ®ç³»ç»Ÿæä¾›çš„è¯è¯­è¿›è¡Œç»˜ç”»ã€‚
2. AI ä½œä¸ºçŒœè¯è€…ï¼Œæ ¹æ®ç»˜ç”»å†…å®¹è¿›è¡ŒçŒœè¯ï¼ŒçŒœä¸­åˆ™ç»˜ç”»æˆåŠŸã€‚

## ğŸ”§ æŠ€æœ¯å®ç°
- **å‰ç«¯**ï¼šåŸºäº React + TypeScript æ„å»ºï¼ŒUI ç°ä»£ç®€æ´ã€‚
- **åç«¯**ï¼šä½¿ç”¨ Python FastAPI æä¾›é«˜æ•ˆçš„ API æœåŠ¡ã€‚
- **AI é›†æˆ**ï¼šæ”¯æŒ OpenAI å’Œç™¾åº¦æ–‡å¿ƒå¤§æ¨¡å‹ï¼Œæ™ºèƒ½ç”Ÿæˆç»˜ç”»æç¤ºã€‚

## ğŸ“¦ å®Œæ•´é¡¹ç›®éƒ¨ç½²æŒ‡å—
1. å…‹éš†é¡¹ç›®ä»£ç ã€‚[é¡¹ç›®åœ°å€](https://github.com/Liyulingyue/DrawSomethingAIPlatform)
2. é…ç½® AI æ¨¡å‹å‚æ•°ï¼ˆAPI Keyã€æ¨¡å‹ URL ç­‰ï¼‰ã€‚
3. å¯åŠ¨å‰åç«¯æœåŠ¡ï¼Œå¼€å§‹æ¸¸æˆï¼

> å¦‚æœä½ ä¸æƒ³éƒ¨ç½²ï¼Œå¯ä»¥å°è¯•åœ¨çº¿ä½“éªŒï¼š[ä½ ç”»AIçŒœ](http://182.92.203.64:5175/app/home/)ã€‚è¿™ä¸ªåœ¨çº¿é“¾æ¥å¯èƒ½ä¼šä¸å®šæœŸæ›´æ–°ã€ç»´æŠ¤æˆ–å¤±æ•ˆï¼Œå¦‚æœæ— æ³•è®¿é—®å°±æ˜¯å¤±æ•ˆäº†~

## åº”ç”¨å®ç°ï¼ˆæ ¸å¿ƒä»£ç ä»‹ç»ï¼‰
å› ä¸ºé¡¹ç›®é‡‡ç”¨äº†å‰åç«¯åˆ†ç¦»æ¶æ„ï¼ˆå‰ç«¯ä¸PythonåŸºæœ¬æ²¡å•¥å…³ç³»ï¼Œæ‰€ä»¥æ— æ³•åœ¨Aistudioä¸Šæ¼”ç¤ºï¼‰ï¼Œå®Œæ•´ä»£ç è¯·å‚è€ƒ GitHub ä»“åº“ï¼š[DrawSomethingAIPlatform](https://github.com/Liyulingyue/DrawSomethingAIPlatform)ã€‚

### ä½¿ç”¨ Ernie4.5 æ¨¡å‹
ä½¿ç”¨Ernie4.5 æ¨¡å‹è¿›è¡Œç»˜ç”»å†…å®¹çš„è¯†åˆ«å’ŒçŒœè¯ï¼Œéœ€è¦ä½ é…ç½®å¥½ç™¾åº¦ AI Studio çš„ API Key å’Œæ¨¡å‹è°ƒç”¨åœ°å€ã€‚
- æ¨¡å‹åç§°ä¸º "ernie-4.5-vl-28b-a3b"
- æ¨¡å‹è°ƒç”¨åœ°å€ä¸º "https://aistudio.baidu.com/llm/lmapi/v3"
- API Key éœ€è¦ä»[ç™¾åº¦ AI Studio](https://aistudio.baidu.com/account/accessToken) è·å–

ä»¥ä¸‹æ˜¯è°ƒç”¨ Ernie4.5 æ¨¡å‹çš„æ ¸å¿ƒä»£ç ç‰‡æ®µï¼Œå±•ç¤ºäº†å¦‚ä½•é€šè¿‡ API è°ƒç”¨è¿›è¡Œç»˜ç”»å†…å®¹çš„è¯†åˆ«ï¼š

```python
# backend/app/services/ai.py
from openai import OpenAI

def _call_ernie_inference(image: str, prompt: str, model_name: Optional[str] = None) -> Dict[str, Any]:
    api_key = os.getenv("AI_STUDIO_API_KEY")
    client = OpenAI(
        api_key=api_key,
        base_url="https://aistudio.baidu.com/llm/lmapi/v3",
    )
    messages = [
        {
            "role": "user",
            "content": [
                {"type": "text", "text": prompt},
                {"type": "image_url", "image_url": {"url": image, "detail": "high"}}
            ]
        }
    ]
    completion = client.chat.completions.create(
        model=model_name or "ernie-4.5-vl-28b-a3b",
        messages=messages,
        stream=False,
    )
    content = completion.choices[0].message.content
    return {"result": content}
```

### æç¤ºè¯è®¾è®¡
æç¤ºè¯çš„è®¾è®¡æ˜¯ AI çŒœè¯å‡†ç¡®æ€§çš„å…³é”®ã€‚ä»¥ä¸‹æ˜¯ç”Ÿæˆæç¤ºè¯çš„ä»£ç ç‰‡æ®µï¼š

```python
# backend/app/services/ai.py
def _build_instruction(clue: Optional[str], custom_prompt: Optional[str]) -> str:
    sections = ["è¯·ä»…è¾“å‡ºä¸€ä¸ª JSON ä»£ç å—ï¼Œä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¿”å›ï¼š"]
    if custom_prompt:
        sections.append(custom_prompt.strip())
    if clue:
        sections.append(f"çŒœè¯çš„å‚è€ƒçº¿ç´¢ï¼š{clue}")
    sections.append("{" + "\n  \"best_guess\": \"æœ€å¯èƒ½çš„ä¸­æ–‡è¯è¯­æˆ–çŸ­è¯­\",\n  \"alternatives\": [\"å¤‡é€‰ç­”æ¡ˆ1\", \"å¤‡é€‰ç­”æ¡ˆ2\"],\n  \"reason\": \"ç®€è¦çš„ä¸­æ–‡è§£é‡Š\"\n}")
    return "\n\n".join(sections)
```

### æ ¸å¿ƒé¡µé¢äº¤äº’ä»£ç 
#### ç”»æ¿å®ç°
ä»¥ä¸‹æ˜¯ç”»æ¿ç»„ä»¶çš„æ ¸å¿ƒä»£ç ï¼Œå±•ç¤ºäº†å¦‚ä½•å®ç°ç»˜ç”»åŠŸèƒ½å¹¶å®æ—¶è·å–ç»˜ç”»æ•°æ®ï¼š

```typescript
// frontend/src/components/DrawBoard.tsx
function DrawBoard({ width, height, disabled = false, onDraw, externalImage }: DrawBoardProps, ref: React.Ref<DrawBoardRef>) {
  const canvasRef = useRef<HTMLCanvasElement>(null)
  const contextRef = useRef<CanvasRenderingContext2D | null>(null)
  const [isDrawing, setIsDrawing] = useState(false)

  const handlePointerDown = useCallback((event: ReactPointerEvent<HTMLCanvasElement>) => {
    if (disabled || event.button !== 0) return
    const ctx = contextRef.current
    if (!ctx) return
    const { x, y } = getCanvasCoords(event.nativeEvent)
    ctx.beginPath()
    ctx.moveTo(x, y)
    setIsDrawing(true)
    event.currentTarget.setPointerCapture(event.pointerId)
  }, [disabled])

  const handlePointerMove = useCallback((event: ReactPointerEvent<HTMLCanvasElement>) => {
    if (!isDrawing) return
    const ctx = contextRef.current
    if (!ctx) return
    const { x, y } = getCanvasCoords(event.nativeEvent)
    ctx.lineTo(x, y)
    ctx.stroke()
  }, [isDrawing])

  const handlePointerUp = useCallback((event: ReactPointerEvent<HTMLCanvasElement>) => {
    if (!isDrawing) return
    const ctx = contextRef.current
    if (!ctx) return
    ctx.closePath()
    setIsDrawing(false)
    event.currentTarget.releasePointerCapture(event.pointerId)

    if (onDraw) {
      const image = canvasRef.current?.toDataURL('image/png')
      if (image) {
        onDraw(image)
      }
    }
  }, [isDrawing, onDraw])

  return (
    <canvas
      ref={canvasRef}
      onPointerDown={handlePointerDown}
      onPointerMove={handlePointerMove}
      onPointerUp={handlePointerUp}
      onPointerCancel={handlePointerUp}
      onPointerLeave={handlePointerUp}
      style={{ border: '1px solid #ccc', borderRadius: '8px' }}
    />
  )
}
```
#### æäº¤ç»˜ç”»æ•°æ®å¹¶è·å– AI çŒœè¯ç»“æœ
ä»¥ä¸‹æ˜¯å‰ç«¯é¡µé¢ä¸åç«¯äº¤äº’çš„ä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•æäº¤ç»˜ç”»æ•°æ®å¹¶è·å– AI çš„çŒœè¯ç»“æœï¼š

```typescript
// frontend/src/pages/AppDraw.tsx
const handleSubmitDrawing = async () => {
  const requestBody = {
    image: drawingData, // ç”¨æˆ·ç»˜åˆ¶çš„å†…å®¹ä»¥ Base64 æ ¼å¼å‘é€
    target: targetWord, // å½“å‰ç»˜ç”»ç›®æ ‡è¯è¯­
    config: {
      url: "https://aistudio.baidu.com/llm/lmapi/v3", // åç«¯è°ƒç”¨çš„ AI æ¨¡å‹åœ°å€
      key: apiKey, // API Key ç”¨äºèº«ä»½éªŒè¯
      model: "ernie-4.5-vl-28b-a3b", // ä½¿ç”¨çš„ AI æ¨¡å‹åç§°
    },
  };
  const response = await fetch("/api/guess", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(requestBody),
  });
  const result = await response.json();
  console.log("AI çŒœè¯ç»“æœ:", result);
};
```

